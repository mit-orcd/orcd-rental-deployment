# =============================================================================
# Nginx Placeholder Configuration
# =============================================================================
# Generated by Ansible - nginx_base role
# Domain: {{ domain_name }}
#
# This is a temporary configuration serving a placeholder page.
# After certbot runs, HTTPS will be configured automatically.
# Application-specific configuration will replace this later.
# =============================================================================

# =============================================================================
# SECURITY: Catch-all servers to reject unknown domains
# =============================================================================
# These prevent domain spoofing and reduce exposure to scanners

# Reject HTTP requests for unknown domains
server {
    listen 80 default_server;
    listen [::]:80 default_server;
    server_name _;
    return 444;  # Nginx special: close connection without response
}

# =============================================================================
# Main domain configuration
# =============================================================================

server {
    listen 80;
    listen [::]:80;
    server_name {{ domain_name }};

    # Security headers
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;

    # Webroot for certbot challenges
    location /.well-known/acme-challenge/ {
        root {{ certbot_webroot }};
    }

    # Placeholder page
    location / {
        root {{ placeholder_root }};
        index index.html;
        try_files $uri $uri/ =404;
    }

    # Health check endpoint
    location /health {
        access_log off;
        return 200 "OK\n";
        add_header Content-Type text/plain;
    }
}
