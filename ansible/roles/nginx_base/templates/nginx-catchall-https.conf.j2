# =============================================================================
# HTTPS Catch-all Server Block
# =============================================================================
# Generated by Ansible - nginx_base role
# Rejects HTTPS requests to unknown/spoofed domains
#
# This file is deployed AFTER certbot obtains the SSL certificate
# =============================================================================

# Reject HTTPS requests for unknown domains
server {
    listen 443 default_server ssl;
    listen [::]:443 default_server ssl;
    server_name _;

    # Reuse the domain's certificate for TLS handshake before rejecting
    ssl_certificate /etc/letsencrypt/live/{{ domain_name }}/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/{{ domain_name }}/privkey.pem;

    # Close connection without response
    return 444;
}
